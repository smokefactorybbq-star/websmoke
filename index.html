<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Smoke Factory BBQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;overflow-x:hidden}
    :root{
      --accent:#16a34a; --danger:#dc2626; --border:#e5e7eb; --muted:#6b7280; --card:#f8fafc;
      --header-pad:16px; --logo:144px; --cats-top:176px;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:#111827;background:#fff;padding-bottom:120px}
    .header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border)}
    .header-inner{max-width:1280px;margin:0 auto;padding:var(--header-pad);display:flex;align-items:center;justify-content:space-between;gap:16px}
    .logo{display:flex;align-items:center;gap:14px;cursor:pointer;min-width:0}
    .logo img{width:var(--logo);height:var(--logo);object-fit:cover;border-radius:16px}
    .brand{display:flex;flex-direction:column}
    .brand-line1{font-size:28px;font-weight:800;line-height:1}
    .brand-line2{font-size:16px;color:var(--muted)}
    .lang{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer;flex:0 0 auto}

    .cats{position:sticky;top:var(--cats-top);z-index:45;background:#fff;border-bottom:1px solid var(--border)}
    .cats-inner{max-width:1280px;margin:0 auto;padding:8px 12px;display:flex;gap:8px;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}
    .cat-btn{padding:8px 10px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer;flex:0 0 auto}
    .cat-btn:hover{background:#f3f4f6}

    .welcome{max-width:1280px;margin:0 auto;padding:14px 12px;text-align:center;font-size:16px;line-height:1.55}

    .layout{max-width:1280px;margin:0 auto;padding:12px;display:grid;grid-template-columns:2fr 1fr;gap:20px}
    .menu-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .card{background:var(--card);border-radius:18px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.08);display:flex;flex-direction:column}
    .card img{width:100%;height:200px;object-fit:cover}
    .card-body{padding:12px 14px;display:flex;flex-direction:column;gap:8px;flex:1;min-width:0}
    .title{font-weight:800}
    .desc{color:var(--muted);font-size:14px;flex:1}
    .price{font-size:18px;font-weight:800;color:#d97706}
    .add{padding:6px 12px;border:0;border-radius:8px;background:#d97706;color:#fff;cursor:pointer}
    .add:hover{background:#b45309}
    .cat-title{margin:20px 0 8px;font-size:22px;border-left:4px solid var(--accent);padding-left:8px}

    .cart{position:sticky;top:calc(var(--cats-top) + 36px);border:1px solid var(--border);border-radius:22px;background:#fff;overflow:hidden;height:fit-content}
    .cart-h{display:flex;align-items:center;gap:8px;padding:12px 14px;border-bottom:1px solid var(--border);background:#f9fafb}
    .cart-body{padding:12px 14px;display:flex;flex-direction:column;gap:10px}
    .addr{color:#2563eb;text-decoration:underline;cursor:pointer}
    .ci{display:grid;grid-template-columns:48px 1fr auto;gap:10px;align-items:center;border-bottom:1px dashed var(--border);padding:10px 0}
    .qty{display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .qty button{width:28px;height:28px;border:0;background:#fff;cursor:pointer}
    .qty span{padding:0 10px}
    .checkout{margin-top:8px;width:100%;padding:14px;font-weight:800;border-radius:14px;border:0;cursor:pointer;background:var(--accent);color:#fff}

    @media (max-width:1024px){.layout{grid-template-columns:1fr}}
    @media (max-width:640px){
      :root{ --header-pad:12px; --logo:96px; --cats-top:120px; }
      .brand-line1{font-size:20px}
      .brand-line2{font-size:13px}
      .menu-grid{grid-template-columns:1fr}
    }

    @media (max-width:768px){
      .mprog{
        position:fixed;left:10px;right:10px;bottom:12px;
        padding:10px 12px calc(env(safe-area-inset-bottom,0) + 10px);
        background:rgba(255,255,255,.98);border:1px solid var(--border);border-radius:14px;
        display:flex;align-items:center;gap:10px;z-index:60;backdrop-filter:saturate(180%) blur(8px)
      }
      .mprog input[type=range]{flex:1;height:8px;border-radius:999px;background:#e5e7eb;appearance:none;outline:none;overflow:hidden}
      .mprog input[type=range]::-webkit-slider-thumb{
        -webkit-appearance:none;width:24px;height:24px;border-radius:6px;background:#16a34a;border:2px solid #fff;box-shadow:0 0 0 2px #16a34a
      }
      .mprog .t{min-width:90px;font-size:12px;color:var(--muted);display:grid;grid-template-columns:1fr auto;gap:6px}
      .mprog .t b{color:#111;font-size:13px}
    }

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:100}
    .modal.show{display:flex}
    .modal-card{width:min(680px,92vw);background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden}
    .modal-h,.modal-f{padding:12px 16px;display:flex;align-items:center;gap:8px;justify-content:space-between;border-bottom:1px solid var(--border)}
    .modal-f{border-top:1px solid var(--border);border-bottom:none}
    .modal-b{padding:16px;display:flex;flex-direction:column;gap:12px}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .pill{padding:8px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
    .pill.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .input{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px}
    .phone{display:flex;align-items:stretch;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .prefix{display:flex;align-items:center;padding:0 10px;background:#f1f5f9;border-right:1px solid var(--border)}
    .pinput{border:none;flex:1;padding:12px;outline:none}
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <div class="logo" id="scrollTopBtn" title="–í –Ω–∞—á–∞–ª–æ">
        <img src="/images/logo.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" onerror="this.src=PLACEHOLDER" />
        <div class="brand">
          <div class="brand-line1">Smoke Factory BBQ</div>
          <div class="brand-line2" id="deliveryText">–î–æ—Å—Ç–∞–≤–∫–∞ —Å 10.00 –¥–æ 22.00 –ü–ù‚Äì–°–ë</div>
        </div>
      </div>
      <button class="lang" id="langBtn" title="Language">üåê EN</button>
    </div>
  </header>

  <div class="cats"><div class="cats-inner" id="catsBar"></div></div>

  <div class="welcome" id="welcomeText">
    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Smoke Factory BBQ. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –±–ª—é–¥–∞ —Ä—É—Å—Å–∫–æ–π –∫—É—Ö–Ω–∏ –∏ –±–ª—é–¥–∞ –∏–∑ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ —Å–º–æ–∫–µ—Ä–∞.
  </div>

  <main class="layout">
    <section id="menu"></section>

    <aside class="cart" id="cart">
      <div class="cart-h">
        <strong id="myOrderLabel">–ú–æ–π –∑–∞–∫–∞–∑</strong>
        <span style="margin-left:auto;font-size:12px;color:#6b7280">üì¶ Delivery</span>
      </div>
      <div class="cart-body">
        <div><span class="addr" id="addrLink">–£–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å</span></div>
        <div id="contactSummary" style="display:none;color:#6b7280;font-size:14px;margin-top:6px"></div>

        <div id="cartItems"></div>

        <div style="border-top:1px solid var(--border);padding-top:10px">
          <div style="color:#6b7280;font-size:14px"><span id="deliveryCostLabel">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏</span>: <span id="deliveryFee">0</span> ‡∏ø</div>
          <div style="color:#6b7280;font-size:14px"><span id="dishesTotalLabel">–°—É–º–º–∞ –±–ª—é–¥</span>: <span id="itemsTotal">0</span> ‡∏ø</div>
          <div style="color:#111827;font-size:14px;font-weight:700"><span id="totalToPayLabel">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span>: <span id="grandTotal">0</span> ‡∏ø</div>
        </div>

        <button class="checkout" id="checkoutBtn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        <div id="fillWarn" style="display:none;color:#ef4444;font-size:12px;margin-top:6px">–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ —Ç–µ–ª–µ—Ñ–æ–Ω</div>
      </div>
    </aside>
  </main>

  <div class="mprog" id="mprog">
    <button id="gotoCartBtn" aria-label="–ú–æ–π –∑–∞–∫–∞–∑" style="width:44px;height:44px;border-radius:10px;border:1px solid var(--border);background:#fff;display:grid;place-items:center;flex:0 0 44px">üõí</button>
    <input id="progressRange" type="range" min="0" max="5000" step="1" value="0" readonly />
    <div class="t"><span>0 ‚Äî 5000</span><b id="progressValue">0</b></div>
  </div>

  <!-- Address Modal -->
  <div class="modal" id="addressModal">
    <div class="modal-card">
      <div class="modal-h"><strong id="addressTitle">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</strong><button class="btn" id="addrClose">–ó–∞–∫—Ä—ã—Ç—å</button></div>
      <div class="modal-b">
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <button class="pill active" id="tabManual">–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</button>
          <button class="pill" id="tabMap">–£–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
        </div>
        <div id="addrManual">
          <input class="input" id="inpAddress" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" />
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <input class="input" id="inpName" placeholder="–ò–º—è" />
            <div class="phone">
              <div class="prefix">+66</div>
              <input class="pinput" id="inpPhone" inputmode="numeric" maxlength="10" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (10 —Ü–∏—Ñ—Ä)" />
            </div>
          </div>
        </div>
        <div id="addrMap" style="display:none">
          <input id="gmaps-search" class="input" placeholder="–ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å (Phuket)" />
          <div id="gmaps" style="width:100%;height:300px;border-radius:12px;border:1px solid var(--border);background:#f3f4f6;margin-top:12px"></div>
        </div>
        <div style="color:var(--muted)">–ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å¬ª —Å—Ç–∞–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.</div>
      </div>
      <div class="modal-f"><button class="btn" id="addrCancel">–û—Ç–º–µ–Ω–∞</button><button class="btn primary" id="addrConfirm" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button></div>
    </div>
  </div>

  <!-- Time Modal -->
  <div class="modal" id="timeModal">
    <div class="modal-card">
      <div class="modal-h"><strong id="timeTitle">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</strong><button class="btn" id="timeClose">–ó–∞–∫—Ä—ã—Ç—å</button></div>
      <div class="modal-b">
        <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="ordertime" value="asap" id="optAsap" checked /> <span id="soonestLabel">–ë–ª–∏–∂–∞–π—à–µ–µ</span></label>
        <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="ordertime" value="scheduled" id="optScheduled" /> <span id="selectTimeLabel">–í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è</span></label>
        <div id="timePick" style="display:none;grid-template-columns:1fr 1fr;gap:12px">
          <select class="input" id="hourSel"></select>
          <select class="input" id="minSel">
            <option>00</option><option>15</option><option>30</option><option>45</option>
          </select>
        </div>
        <div>
          <label style="display:block;margin-bottom:6px;color:#6b7280" id="commentLabel">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
          <textarea class="input" rows="3" id="commentInp" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –±–µ–∑ –ª—É–∫–∞, –ø–æ–∑–≤–æ–Ω–∏—Ç—å –ø—Ä–∏ –ø—Ä–∏–±—ã—Ç–∏–∏‚Ä¶"></textarea>
        </div>
      </div>
      <div class="modal-f"><button class="btn" id="timeCancel">–û—Ç–º–µ–Ω–∞</button><button class="btn primary" id="timeConfirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button></div>
    </div>
  </div>

  <script>
    // üîë –¢–û–õ–¨–ö–û Google Maps –∫–ª—é—á –≤–∏–¥–µ–Ω –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –µ–≥–æ –≤ Google Cloud –ø–æ –¥–æ–º–µ–Ω—É!
    const GOOGLE_MAPS_API_KEY = "AIzaSyDpkOIC_DHo3gZgyibtJcRB92CjtPh97ik";

    const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(
      '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect width="100%" height="100%" fill="#e5e7eb"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#6b7280" font-family="Arial" font-size="20">no image</text></svg>'
    );

    const MENU = {
      "–°—É–ø—ã": [
        { name:"–ì–æ—Ä–æ—Ö–æ–≤—ã–π —Å—É–ø", img:"/images/goroh-soup1.jpeg", price:350, desc:"–ù–∞–≤–∞—Ä–∏—Å—Ç—ã–π —Å—É–ø —Å –∫–æ–ø—á–µ–Ω–æ—Å—Ç—è–º–∏ –∏ –∑–µ–ª–µ–Ω—å—é" },
        { name:"–ë–æ—Ä—â",         img:"/images/borsh.jpeg",       price:360, desc:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π –±–æ—Ä—â —Å –º—è—Å–æ–º" },
        { name:"–°–æ–ª—è–Ω–∫–∞",      img:"/images/solyanka.jpeg",    price:380, desc:"–ú—è—Å–Ω–∞—è —Å–æ–ª—è–Ω–∫–∞ —Å –æ–ª–∏–≤–∫–∞–º–∏ –∏ –ª–∏–º–æ–Ω–æ–º" },
      ],
      "–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞": [
        { name:"–ë–µ—Ñ—Å—Ç—Ä–æ–≥–∞–Ω–æ–≤",         img:"/images/befstroganoff.jpeg",          price:650, desc:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –±–ª—é–¥–æ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã –≤ —Å–º–µ—Ç–∞–Ω–Ω–æ–º —Å–æ—É—Å–µ" },
        { name:"–ö–æ—Ç–ª–µ—Ç–∞ –ø–æ-–∫–∏–µ–≤—Å–∫–∏",   img:"/images/kotlety-po-kievski.jpeg",     price:520, desc:"–ö—É—Ä–∏–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞ —Å –º–∞—Å–ª–æ–º –∏ –∑–µ–ª–µ–Ω—å—é" },
        { name:"–ü–µ–ª—å–º–µ–Ω–∏",             img:"/images/pelmeni.jpeg",                price:380, desc:"–î–æ–º–∞—à–Ω–∏–µ –ø–µ–ª—å–º–µ–Ω–∏ —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π" },
        { name:"–í–∞—Ä–µ–Ω–∏–∫–∏",             img:"/images/vareniki.jpeg",               price:360, desc:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª–µ–º –∏ —Å–º–µ—Ç–∞–Ω–æ–π" },
        { name:"–õ–µ–ø–µ—à–∫–∞ —Å —Å—ã—Ä–æ–º",      img:"/images/lepeshka-s-sirom1.jpeg",      price:180, desc:"–ì–æ—Ä—è—á–∞—è –ª–µ–ø–µ—à–∫–∞ —Å —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω—ã–º —Å—ã—Ä–æ–º" },
      ],
      "–°–∞–ª–∞—Ç—ã": [
        { name:"–°–∞–ª–∞—Ç –¶–µ–∑–∞—Ä—å",     img:"/images/salat-cezar.jpeg",     price:420, desc:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–∞–ª–∞—Ç —Å –∫—É—Ä–∏—Ü–µ–π, –ø–∞—Ä–º–µ–∑–∞–Ω–æ–º –∏ —Å—É—Ö–∞—Ä–∏–∫–∞–º–∏" },
        { name:"–°–∞–ª–∞—Ç —Å –±–∞–∫–ª–∞–∂–∞–Ω–∞–º–∏", img:"/images/salat-baklazhan.jpeg", price:390, desc:"–¢—ë–ø–ª—ã–π —Å–∞–ª–∞—Ç —Å –∂–∞—Ä–µ–Ω—ã–º–∏ –±–∞–∫–ª–∞–∂–∞–Ω–∞–º–∏" },
        { name:"–°–∞–ª–∞—Ç —Å —Ç—É–Ω—Ü–æ–º",   img:"/images/salat-tunec.jpeg",     price:440, desc:"–°–≤–µ–∂–∏–π —Å–∞–ª–∞—Ç —Å —Ç—É–Ω—Ü–æ–º –∏ —è–π—Ü–æ–º" },
      ],
      "–ì—Ä–∏–ª—å": [
        { name:"–ö–µ–±–∞–± –∏–∑ –∫—É—Ä–∏—Ü—ã",            img:"/images/kebab-kur.jpeg",   price:420, desc:"–°–æ—á–Ω—ã–π –∫—É—Ä–∏–Ω—ã–π –∫–µ–±–∞–± —Å –æ–≤–æ—â–∞–º–∏" },
        { name:"–ö–µ–±–∞–± –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã –∏ –≥–æ–≤—è–¥–∏–Ω—ã", img:"/images/kebab-mix.jpeg",  price:520, desc:"–ú–∏–∫—Å –Ω–∞ –≥—Ä–∏–ª–µ –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã –∏ –≥–æ–≤—è–¥–∏–Ω—ã" },
        { name:"–®–∞—à–ª—ã–∫ –∏–∑ –∫—É—Ä–∏—Ü—ã",           img:"/images/shashlik-kur.jpeg", price:450, desc:"–ú–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä–∏–Ω—ã–π —à–∞—à–ª—ã–∫" },
        { name:"–®–∞—à–ª—ã–∫ –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã",          img:"/images/shashlik-svin.jpeg", price:520, desc:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–≤–∏–Ω–æ–π —à–∞—à–ª—ã–∫" },
        { name:"–†–µ–±—Ä–∞ BBQ",                  img:"/images/ribs-bbq.jpeg",    price:690, desc:"–ö–æ–ø—á–µ–Ω—ã–µ —Å–≤–∏–Ω—ã–µ —Ä–µ–±—Ä–∞ –≤ —Å–æ—É—Å–µ BBQ" },
      ],
      "–ó–∞–º–æ—Ä–æ–∑–∫–∞": [
        { name:"–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏",      img:"/images/fri.jpeg",    price:160, desc:"–•—Ä—É—Å—Ç—è—â–∏–π –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏" },
        { name:"–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–µ –¥–æ–ª—å–∫–∏", img:"/images/wedges.jpeg", price:170, desc:"–ó–∞–ø–µ—á–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–µ –¥–æ–ª—å–∫–∏" },
      ],
      "–ö–æ–ø—á–µ–Ω–∏–µ": [
        { name:"–°–≤–∏–Ω–∞—è –∫–æ–ª–±–∞—Å–∞",           img:"/images/kolbasa-svinaya1.jpeg", price:420, desc:"–î–æ–º–∞—à–Ω—è—è –∫–æ–ø—á–µ–Ω–∞—è —Å–≤–∏–Ω–∞—è –∫–æ–ª–±–∞—Å–∞" },
        { name:"–ö–æ–ø—á–µ–Ω–∞—è –∫—É—Ä–∏—Ü–∞",          img:"/images/kopch-kur.jpeg",        price:480, desc:"–ê—Ä–æ–º–∞—Ç–Ω–∞—è –∫–æ–ø—á–µ–Ω–∞—è –∫—É—Ä–∏—Ü–∞" },
        { name:"–ö–æ–ø—á–µ–Ω—ã–π –±–µ–∫–æ–Ω",           img:"/images/bacon.jpeg",            price:450, desc:"–ù–∞—Ä–µ–∑–∫–∞ –∫–æ–ø—á–µ–Ω–æ–≥–æ –±–µ–∫–æ–Ω–∞" },
        { name:"–ö–æ–ø—á–µ–Ω–∞—è —Å–≤–∏–Ω–∞—è –∫–æ—Ä–µ–π–∫–∞",  img:"/images/koreyka.jpeg",          price:540, desc:"–î–µ–ª–∏–∫–∞—Ç–µ—Å–Ω–∞—è –∫–æ–ø—á–µ–Ω–∞—è –∫–æ—Ä–µ–π–∫–∞" },
      ],
    };

    const I18N = {
      ru: {
        delivery: "–î–æ—Å—Ç–∞–≤–∫–∞ —Å 10.00 –¥–æ 22.00 –ü–ù‚Äì–°–ë",
        welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Smoke Factory BBQ. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –±–ª—é–¥–∞ —Ä—É—Å—Å–∫–æ–π –∫—É—Ö–Ω–∏ –∏ –±–ª—é–¥–∞ –∏–∑ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–≥–æ —Å–º–æ–∫–µ—Ä–∞.",
        addToCart: "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É",
        myOrder: "–ú–æ–π –∑–∞–∫–∞–∑",
        specifyAddress: "–£–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å",
        address: "–ê–¥—Ä–µ—Å",
        name: "–ò–º—è",
        phone: "–¢–µ–ª–µ—Ñ–æ–Ω",
        deliveryCost: "–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏",
        dishesTotal: "–°—É–º–º–∞ –±–ª—é–¥",
        totalToPay: "–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ",
        placeOrder: "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑",
        remove: "—É–¥–∞–ª–∏—Ç—å",
        fillAddress: "–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ —Ç–µ–ª–µ—Ñ–æ–Ω",
        addressTitle: "–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏",
        soonest: "–ë–ª–∏–∂–∞–π—à–µ–µ",
        selectTime: "–í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è",
        comment: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É",
        thankYou: "–°–ø–∞—Å–∏–±–æ! –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.",
        failed: "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ."
      },
      en: {
        delivery: "Delivery 10.00 to 22.00 MON‚ÄìSAT",
        welcome: "Welcome to Smoke Factory BBQ. Classic Russian cuisine and American-smoked dishes.",
        addToCart: "Add to cart",
        myOrder: "My order",
        specifyAddress: "Specify address",
        address: "Address",
        name: "Name",
        phone: "Phone",
        deliveryCost: "Delivery cost",
        dishesTotal: "Dishes total",
        totalToPay: "Total to pay",
        placeOrder: "Place order",
        remove: "remove",
        fillAddress: "Please enter address and phone",
        addressTitle: "Delivery Address",
        soonest: "Soonest",
        selectTime: "Select time",
        comment: "Order Comment",
        thankYou: "Thank you! Order sent.",
        failed: "Failed to send order. Check connection."
      }
    };

    let lang = "ru";
    let cart = {};
    let customer = { address:"", name:"", phone:"" };
    const DELIVERY_FEE_DEFAULT = 100;

    const validPhone = (p) => /^\+66\d{9,10}$/.test(p);
    const itemsTotal = () => Object.values(cart).reduce((s,it)=>s+it.qty*it.price,0);
    const deliveryFee = () => customer.address ? DELIVERY_FEE_DEFAULT : 0;
    const grandTotal = () => itemsTotal() + deliveryFee();
    const scrollToTop = () => window.scrollTo({ top: 0, behavior: "smooth" });
    const safe = (s) => String(s).replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));

    function loadGoogleMaps(apiKey){
      if(!apiKey) return Promise.resolve();
      return new Promise((resolve,reject)=>{
        if(window.google?.maps) return resolve();
        const ex = document.querySelector('script[data-gmaps="1"]');
        if(ex){ ex.addEventListener("load",()=>resolve()); ex.addEventListener("error",()=>reject()); return; }
        const s=document.createElement("script");
        s.src=`https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`; s.async=true; s.defer=true; s.dataset.gmaps="1";
        s.onload=()=>resolve(); s.onerror=()=>reject(new Error("Google Maps failed to load"));
        document.head.appendChild(s);
      });
    }

    function renderCats(){
      const bar = document.getElementById("catsBar");
      bar.innerHTML = "";
      Object.keys(MENU).forEach(c=>{
        const b=document.createElement("button");
        b.className="cat-btn";
        b.textContent=c;
        b.onclick=()=>document.getElementById("cat-"+c.toLowerCase().replace(/\s+/g,"-")).scrollIntoView({behavior:"smooth",block:"start"});
        bar.appendChild(b);
      });
    }
    function renderMenu(){
      const root = document.getElementById("menu");
      root.innerHTML = "";
      Object.entries(MENU).forEach(([cat,items])=>{
        const wrap=document.createElement("div");
        const h=document.createElement("div");
        h.className="cat-title"; h.id="cat-"+cat.toLowerCase().replace(/\s+/g,"-");
        h.textContent=cat;
        const grid=document.createElement("div");
        grid.className="menu-grid";
        items.forEach(it=>{
          const card=document.createElement("div"); card.className="card";
          const img=document.createElement("img"); img.src=it.img || PLACEHOLDER; img.alt=it.name; img.onerror=()=>{img.src=PLACEHOLDER};
          const body=document.createElement("div"); body.className="card-body";
          const t=document.createElement("div"); t.className="title"; t.textContent=it.name;
          const d=document.createElement("div"); d.className="desc"; d.textContent=it.desc;
          const foot=document.createElement("div"); foot.style.display="flex"; foot.style.justifyContent="space-between"; foot.style.alignItems="center"; foot.style.marginTop="auto";
          const price=document.createElement("div"); price.className="price"; price.textContent=it.price+" ‡∏ø";
          const add=document.createElement("button"); add.className="add"; add.textContent=I18N[lang].addToCart;
          add.onclick=()=>{ addToCart(it); };
          foot.append(price,add); body.append(t,d,foot); card.append(img,body); grid.append(card);
        });
        wrap.append(h,grid); root.append(wrap);
      });
    }
    function renderCart(){
      const itemsRoot = document.getElementById("cartItems");
      itemsRoot.innerHTML = "";
      Object.entries(cart).forEach(([name,it])=>{
        const row=document.createElement("div"); row.className="ci";
        const img=document.createElement("img"); img.src=it.img||PLACEHOLDER; img.alt=name; img.style.width="48px"; img.style.height="48px"; img.style.objectFit="cover"; img.style.borderRadius="8px"; img.onerror=()=>{img.src=PLACEHOLDER};
        const mid=document.createElement("div");
        const top=document.createElement("div"); top.style.display="flex"; top.style.justifyContent="space-between"; top.style.gap="8px"; top.style.alignItems="center";
        const strong=document.createElement("strong"); strong.textContent=name;
        const rm=document.createElement("button"); rm.textContent=I18N[lang].remove; rm.style.color="var(--danger)"; rm.style.border="0"; rm.style.background="transparent"; rm.style.cursor="pointer"; rm.style.fontSize="12px";
        rm.onclick=()=>{ delete cart[name]; updateUI(); };
        top.append(strong,rm);
        const sum=document.createElement("div"); sum.style.color="#6b7280"; sum.style.fontSize="14px"; sum.innerHTML = `${it.price} ‡∏ø √ó ${it.qty} = <strong>${it.qty*it.price} ‡∏ø</strong>`;
        mid.append(top,sum);
        const qty=document.createElement("div"); qty.className="qty";
        const minus=document.createElement("button"); minus.textContent="‚àí"; minus.onclick=()=>{ it.qty--; if(it.qty<=0) delete cart[name]; updateUI(); };
        const cnt=document.createElement("span"); cnt.textContent=String(it.qty);
        const plus=document.createElement("button"); plus.textContent="+"; plus.onclick=()=>{ it.qty++; updateUI(); };
        qty.append(minus,cnt,plus);
        row.append(img,mid,qty); itemsRoot.append(row);
      });

      document.getElementById("deliveryFee").textContent = String(deliveryFee());
      document.getElementById("itemsTotal").textContent = String(itemsTotal());
      document.getElementById("grandTotal").textContent = String(grandTotal());

      const prog = Math.min(5000, itemsTotal());
      document.getElementById("progressRange").value = String(prog);
      document.getElementById("progressValue").textContent = String(itemsTotal());
    }
    function renderContactSummary(){
      const box = document.getElementById("contactSummary");
      if(customer.address){
        box.style.display="block";
        box.innerHTML = `<div><strong>${I18N[lang].address}:</strong> ${safe(customer.address)}</div>` +
                        (customer.name? `<div><strong>${I18N[lang].name}:</strong> ${safe(customer.name)}</div>`:"") +
                        (customer.phone? `<div><strong>${I18N[lang].phone}:</strong> ${safe(customer.phone)}</div>`:"");
      } else {
        box.style.display="none"; box.innerHTML="";
      }
      document.getElementById("fillWarn").style.display = (!customer.address || !validPhone(customer.phone)) ? "block" : "none";
    }
    function applyLang(){
      document.getElementById("deliveryText").textContent = I18N[lang].delivery;
      document.getElementById("welcomeText").textContent  = I18N[lang].welcome;
      document.getElementById("myOrderLabel").textContent = I18N[lang].myOrder;
      document.getElementById("addrLink").textContent     = I18N[lang].specifyAddress;
      document.getElementById("deliveryCostLabel").textContent = I18N[lang].deliveryCost;
      document.getElementById("dishesTotalLabel").textContent  = I18N[lang].dishesTotal;
      document.getElementById("totalToPayLabel").textContent   = I18N[lang].totalToPay;
      document.getElementById("checkoutBtn").textContent = I18N[lang].placeOrder;
      document.getElementById("addressTitle").textContent = I18N[lang].addressTitle;
      document.getElementById("soonestLabel").textContent = I18N[lang].soonest;
      document.getElementById("selectTimeLabel").textContent = I18N[lang].selectTime;
      document.getElementById("commentLabel").textContent = I18N[lang].comment;
      document.getElementById("fillWarn").textContent = I18N[lang].fillAddress;
      document.querySelectorAll(".add").forEach(btn=>btn.textContent=I18N[lang].addToCart);
      document.getElementById("langBtn").textContent = (lang === "ru") ? "üåê EN" : "üåê RU";
    }
    function updateUI(){ renderCart(); renderContactSummary(); applyLang(); }

    function addToCart(item){
      const ex=cart[item.name];
      if(ex) ex.qty++; else cart[item.name]={qty:1, price:item.price, img:item.img};
      updateUI();
    }

    const addressModal = document.getElementById("addressModal");
    const timeModal    = document.getElementById("timeModal");
    function showModal(el){ el.classList.add("show"); }
    function hideModal(el){ el.classList.remove("show"); }

    (function(){
      const btnOpen = document.getElementById("addrLink");
      const btnClose= document.getElementById("addrClose");
      const btnCancel=document.getElementById("addrCancel");
      const btnConfirm=document.getElementById("addrConfirm");
      const tabManual=document.getElementById("tabManual");
      const tabMap   =document.getElementById("tabMap");
      const paneManual=document.getElementById("addrManual");
      const paneMap   =document.getElementById("addrMap");
      const inpAddress=document.getElementById("inpAddress");
      const inpName   =document.getElementById("inpName");
      const inpPhone  =document.getElementById("inpPhone");

      function validate(){
        const ok = inpAddress.value.trim().length>3 && /^\d{9,10}$/.test(inpPhone.value);
        btnConfirm.disabled = !ok;
      }
      [inpAddress,inpName,inpPhone].forEach(el=>el.addEventListener("input",validate));

      tabManual.onclick=()=>{
        tabManual.classList.add("active"); tabMap.classList.remove("active");
        paneManual.style.display="block"; paneMap.style.display="none";
      };
      tabMap.onclick=async()=>{
        tabMap.classList.add("active"); tabManual.classList.remove("active");
        paneManual.style.display="none"; paneMap.style.display="block";
        try {
          await loadGoogleMaps(GOOGLE_MAPS_API_KEY);
          const g=window.google;
          if(!g?.maps) return;
          const center={lat:7.878978,lng:98.398392};
          const map=new g.maps.Map(document.getElementById("gmaps"),{center,zoom:12});
          const marker=new g.maps.Marker({position:center,map,draggable:true});
          const geocoder=new g.maps.Geocoder();
          marker.addListener("dragend", async ()=>{
            const pos=marker.getPosition(); if(!pos) return;
            const {results}=await geocoder.geocode({location:pos});
            if(results && results[0]) inpAddress.value = results[0].formatted_address, validate();
          });
          const acInput=document.getElementById("gmaps-search");
          const ac=new g.maps.places.Autocomplete(acInput,{fields:["formatted_address","geometry"]});
          ac.addListener("place_changed",()=>{
            const place=ac.getPlace(); if(!place||!place.geometry) return;
            const loc=place.geometry.location;
            map.panTo(loc); map.setZoom(15); marker.setPosition(loc);
            inpAddress.value = place.formatted_address || ""; validate();
          });
        } catch(e){ console.error("GMaps init error:", e); }
      };

      btnOpen.onclick = ()=> showModal(addressModal);
      btnClose.onclick= ()=> hideModal(addressModal);
      btnCancel.onclick=()=> hideModal(addressModal);
      btnConfirm.onclick=()=>{
        customer.address = inpAddress.value.trim();
        customer.name    = inpName.value.trim();
        customer.phone   = "+66"+ inpPhone.value.replace(/\D/g,"");
        hideModal(addressModal);
        showModal(timeModal);
        updateUI();
      };
    })();

    (function(){
      const btnClose  = document.getElementById("timeClose");
      const btnCancel = document.getElementById("timeCancel");
      const btnConfirm= document.getElementById("timeConfirm");
      const optAsap   = document.getElementById("optAsap");
      const optSched  = document.getElementById("optScheduled");
      const picker    = document.getElementById("timePick");
      const hourSel   = document.getElementById("hourSel");
      const minSel    = document.getElementById("minSel");
      const comment   = document.getElementById("commentInp");

      for(let h=9; h<=22; h++){
        const v=String(h).padStart(2,"0");
        const opt=document.createElement("option"); opt.value=v; opt.textContent=v; hourSel.append(opt);
      }

      function modeUpdate(){ picker.style.display = optSched.checked ? "grid" : "none"; }
      optAsap.onchange=modeUpdate; optSched.onchange=modeUpdate;

      btnClose.onclick = ()=> hideModal(timeModal);
      btnCancel.onclick=()=> hideModal(timeModal);

      btnConfirm.onclick=async()=>{
        const items={}; Object.entries(cart).forEach(([name,it])=> items[name]={qty:it.qty, price:it.price});
        const payload = {
          items,
          phone: customer.phone,
          name:  customer.name,
          address: customer.address,
          delivery: deliveryFee(),
          total: grandTotal(),
          comment: comment.value.trim(),
          orderDate: new Date().toISOString().slice(0,10),
          orderTime: optSched.checked ? `${hourSel.value}:${minSel.value}` : "soonest",
          orderWhen: optSched.checked ? "scheduled" : "asap",
          source: "html",
        };

        try{
          await sendOrderViaAPI(payload);
          alert(I18N[lang].thankYou);
          cart = {}; updateUI(); hideModal(timeModal);
        }catch(e){
          console.error(e);
          alert(I18N[lang].failed);
        }
      };
    })();

    document.getElementById("checkoutBtn").onclick = ()=>{
      if(!customer.address || !validPhone(customer.phone)){
        document.getElementById("fillWarn").style.display = "block";
        document.getElementById("addrLink").click();
      } else {
        showModal(timeModal);
      }
    };

    document.getElementById("gotoCartBtn").onclick = ()=> document.getElementById("cart").scrollIntoView({behavior:"smooth",block:"start"});
    document.getElementById("scrollTopBtn").onclick = scrollToTop;

    document.getElementById("langBtn").onclick = ()=>{
      lang = (lang === "ru") ? "en" : "ru";
      applyLang(); renderMenu();
    };

    async function sendOrderViaAPI(payload){
      const res = await fetch("/api/order", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error("API error " + res.status);
      return res.json();
    }

    function renderAll(){
      renderCats();
      renderMenu();
      updateUI();
      applyLang();
    }
    renderAll();
  </script>
</body>
</html>

